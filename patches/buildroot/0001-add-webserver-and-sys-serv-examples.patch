From 1c0a04433b7ce1cf1bd5c905386931781ea3d06e Mon Sep 17 00:00:00 2001
From: Conor Dooley <conor.dooley@microchip.com>
Date: Thu, 14 Jan 2021 12:03:32 +0000
Subject: [PATCH] add webserver and sys serv examples

---
 package/Config.in              |  1 +
 package/mchp_examples/Config.in    |  4 ++++
 package/mchp_examples/mchp_examples.mk | 34 ++++++++++++++++++++++++++++++++++
 3 files changed, 39 insertions(+)
 create mode 100644 package/mchp_examples/Config.in
 create mode 100644 package/mchp_examples/mchp_examples.mk

diff --git a/package/Config.in b/package/Config.in
index 17d2bd4f92..936bceb416 100644
--- a/package/Config.in
+++ b/package/Config.in
@@ -8,6 +8,7 @@ menu "Target packages"
 	source "package/skeleton-init-openrc/Config.in"
 	source "package/skeleton-init-systemd/Config.in"
 	source "package/skeleton-init-sysv/Config.in"
+	source "package/mchp_examples/Config.in"
 
 menu "Audio and video applications"
 	source "package/alsa-utils/Config.in"
diff --git a/package/mchp_examples/Config.in b/package/mchp_examples/Config.in
new file mode 100644
index 0000000000..ef74da98b8
--- /dev/null
+++ b/package/mchp_examples/Config.in
@@ -0,0 +1,4 @@
+config BR2_PACKAGE_MCHP_EXAMPLES
+	bool "mchp_examples"
+	help
+	  blah blah blah
diff --git a/package/mchp_examples/mchp_examples.mk b/package/mchp_examples/mchp_examples.mk
new file mode 100644
index 0000000000..5b19995f6a
--- /dev/null
+++ b/package/mchp_examples/mchp_examples.mk
@@ -0,0 +1,34 @@
+MCHP_EXAMPLES_VERSION = d8981e9d0d1e20d811b243d0e4e55d1fa9897144
+MCHP_EXAMPLES_SITE = https://bitbucket.microchip.com/scm/fpga_pfsoc_es/polarfire-soc-linux-examples.git
+MCHP_EXAMPLES_SITE_METHOD = git
+
+define MCHP_EXAMPLES_INSTALL_TARGET_CMDS
+# iiohttp server
+$(INSTALL) -d $(TARGET_DIR)/opt/microchip/iiohttpserver
+chmod a+x $(TARGET_DIR)/opt/microchip/iiohttpserver
+cp -r $(@D)/iiohttpserver $(TARGET_DIR)/opt/microchip/
+
+# sys services test program
+$(TARGET_MAKE_ENV) $(MAKE) -C $(@D)/system-services CC=$(TARGET_CC)
+$(INSTALL) -d $(TARGET_DIR)/opt/microchip/system-services
+$(INSTALL) -D -m 775 $(@D)/system-services/system-services-example \
+        $(TARGET_DIR)/opt/microchip/system-services/system-services-example
+endef
+
+define MCHP_EXAMPLES_INSTALL_INIT_SYSTEMD
+$(INSTALL) -D -m 644 $(@D)/iiohttpserver/collection/collectdiio.service \
+        $(TARGET_DIR)/usr/lib/systemd/system/collectdiio.service
+endef
+
+define MCHP_EXAMPLES_INSTALL_INIT_SYSV
+# iiohttp server
+$(INSTALL) -D -m 775 $(@D)/iiohttpserver/collection/collectdiio.busybox \
+        $(TARGET_DIR)/etc/init.d/collectdiio
+# busy box init requires script renames
+mv $(TARGET_DIR)/opt/microchip/iiohttpserver/run.{sh,systemd}
+mv $(TARGET_DIR)/opt/microchip/iiohttpserver/run.{busybox,sh}
+chmod +x $(TARGET_DIR)/opt/microchip/iiohttpserver/run.sh
+
+endef
+
+$(eval $(generic-package))
-- 
2.17.1

